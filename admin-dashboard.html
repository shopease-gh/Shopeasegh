<!-- Updated Add/Remove Products Tab with File Upload -->
<div id="products" class="tab-content section-box">
  <h3>Add/Remove Products</h3>
  <form id="addProductForm">
    <input type="text" id="productName" placeholder="Product Name" required><br>
    <input type="number" id="productPrice" placeholder="Price (‚Çµ)" required><br>
    <select id="productCategory" required></select><br>
    <textarea id="productDescription" placeholder="Description" required></textarea><br>
    <input type="file" id="productImage" accept="image/png, image/jpeg" required><br>
    <button type="submit">Add Product</button>
  </form>

  <div id="productList" style="margin-top:20px;"></div>
</div>

<script>
  let products = JSON.parse(localStorage.getItem("products") || "[]");

  document.getElementById("addProductForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const name = document.getElementById("productName").value;
    const price = parseFloat(document.getElementById("productPrice").value);
    const category = document.getElementById("productCategory").value;
    const description = document.getElementById("productDescription").value;
    const fileInput = document.getElementById("productImage");
    const file = fileInput.files[0];

    if (!file || !file.type.startsWith("image/")) {
      alert("Please upload a valid image file.");
      return;
    }

    const reader = new FileReader();
    reader.onload = function(event) {
      const imageUrl = event.target.result;
      const product = { name, price, category, description, image: imageUrl };
      products.push(product);
      localStorage.setItem("products", JSON.stringify(products));
      renderProducts();
      e.target.reset();
    };
    reader.readAsDataURL(file);
  });

  function renderProducts() {
    const container = document.getElementById("productList");
    container.innerHTML = products.map((p, i) => `
      <div style="border:1px solid gold; margin-bottom:10px; padding:10px; border-radius:8px;">
        <img src="${p.image}" style="width:100px;height:auto;border-radius:6px;" alt="Product Image"/><br>
        <strong>${p.name}</strong><br>‚Çµ${p.price}<br>${p.category}<br>${p.description}<br>
        <button onclick="removeProduct(${i})" style="margin-top:10px;background:crimson;color:white;">üóëÔ∏è Remove</button>
      </div>
    `).join("");
  }

  function removeProduct(index) {
    if (confirm("Remove this product?")) {
      products.splice(index, 1);
      localStorage.setItem("products", JSON.stringify(products));
      renderProducts();
    }
  }

  renderProducts();
</script>

<!-- Inbox Tab Fix -->
<div id="inbox" class="tab-content section-box">
  <h3>Inbox</h3>
  <div id="inboxMessages"></div>
</div>

<script>
  const messages = JSON.parse(localStorage.getItem("inboxMessages") || "[]");

  function renderInbox() {
    const inbox = document.getElementById("inboxMessages");
    if (!inbox) return;
    if (messages.length === 0) {
      inbox.innerHTML = "<p>No messages yet.</p>";
      return;
    }
    inbox.innerHTML = messages.map((msg, idx) => `
      <div style="border:1px solid gold;padding:10px;border-radius:8px;margin-bottom:10px;">
        <strong>From:</strong> ${msg.name}<br/>
        <strong>Email:</strong> ${msg.email}<br/>
        <strong>Message:</strong> ${msg.message}<br/>
        <textarea id="reply_${idx}" placeholder="Write reply..." style="width:100%;margin-top:5px;"></textarea><br>
        <button onclick="replyToMessage(${idx})">Send Reply</button>
      </div>
    `).join("");
  }

  function replyToMessage(index) {
    const reply = document.getElementById(`reply_${index}`).value;
    if (reply.trim() === "") return alert("Reply can't be empty.");
    alert("Reply sent to: " + messages[index].email + "\nMessage: " + reply);
    document.getElementById(`reply_${index}`).value = "";
  }

  renderInbox();
</script>
